

Load packages and data:

```{r}
#| label: load-packages
#| message: false

library(tidyverse)
library(googlesheets4)
```

# Exercises

## Exercise 1

```{r}
#| label: ex1

mass_shootings <- read_sheet("https://docs.google.com/spreadsheets/d/1b9o6uDO18sLxBqPwl_Gh9bnhW-ev_dABH83M5Vb5L8o/edit#gid=0")


```

## Exercise 2

```{r}
#| label: ex2
library(dplyr)
library(stringi)
library(janitor)

# Rename columns
mass_shootings <- mass_shootings |>
  rename(
    location_type = `location...8`,
    incident_type = type,
    location = `location...2`,
    prior_mental_illness = prior_signs_mental_health_issues
  )

# Transform text data to title case
mass_shootings <- mass_shootings %>%
  mutate(
    location_type = stri_trans_totitle(location_type),
    prior_mental_illness = stri_trans_totitle(prior_mental_illness),
    weapons_obtained_legally = stri_trans_totitle(weapons_obtained_legally),
    race = stri_trans_totitle(race),
    incident_type = stri_trans_totitle(incident_type)
  )

# Collapse the gender column 
mass_shootings$gender <- case_when(
  tolower(mass_shootings$gender) %in% 
    c("m", "male") ~ "Male",
  tolower(mass_shootings$gender) %in% 
    c("f", "female") ~ "Female",
  grepl("transgender",
        tolower(mass_shootings$gender)) ~ "Transgender",
  TRUE ~ mass_shootings$gender
)

# Remove columns that do not provide substantive information 
mass_shootings <- mass_shootings |>
  select(-contains(c("details", "source", "where_obtained", "weapon_type", "longitude", "latitude"))) |>
  
#Ensure variables are stored as appropriate types and classes 
  mutate(
    date = as.Date(date),
    month = format(date, "%B"),
    year = as.numeric(year(date)),
    fatalities = as.numeric(fatalities),
    injured = as.numeric(injured),
    total_victims = as.numeric(total_victims),
    age_of_shooter = as.numeric(age_of_shooter)
  ) |>
  
  mutate_at(vars(-date), ~ ifelse(. %in% c("-", "Tod", "Unclear", "Unknown"), NA, .))|>
  mutate(weapons_obtained_legally = ifelse(weapons_obtained_legally %in% c('Yes', 'No'), weapons_obtained_legally, NA))

# Clean column names using janitor
mass_shootings <- mass_shootings |>
  clean_names()

mass_shootings <- mass_shootings |>
  select(case, date, year, month, everything())


# Glimpse the cleaned dataset
head(mass_shootings)
```

```{r}
#| label: compare
#| eval: false
#| include: false

# import pre-cleaned version
mass_shootings_precleaned <- read_rds(
  file = "data/mass-shootings.rds")

# compare to what you created (assuming you named the data frame mass_shootings)
waldo::compare(
  x = mass_shootings_precleaned, y = mass_shootings,
  tolerance = 1e-4
)
```

## Exercise 3

```{r}
#| label: ex3



# Plot 1
boxplot_plot <- ggplot(mass_shootings, 
                       aes(x = location_type,
                           y = total_victims)) +
  geom_boxplot(fill = "red", color = "red4") + 
  labs(x = "Location Type", 
       y = "Total Victims") +
  ggtitle("Boxplot: Total Victims by Location Type") +
  theme(axis.text.x = element_text( hjust = 1))

print(boxplot_plot)


#Plot 2


mass_shootings_without_vegas <- mass_shootings |>
  filter(case != "Las Vegas Strip massacre")

boxplot_plot_without_vegas <- ggplot( mass_shootings_without_vegas, 
  aes(x = location_type, 
      y = total_victims)) +
  geom_boxplot(fill = "orange", color = "black") +  
  labs(x = "Location Type", 
       y = "Total Victims") +
  ggtitle("Boxplot : Total Victims by Location Type 
excluding Las Vegas") +
  theme(axis.text.x = element_text( hjust = 1))

print(boxplot_plot_without_vegas)


#This plot is for my own reference 
boxplot_plot3 <- ggplot(mass_shootings, aes(x = location_type, y = total_victims)) +
  geom_boxplot(fill = "red", color = "red4") +
  labs(x = "Location Type", y = "Total Victims") +
  ggtitle("Boxplot: Total Victims by Location Type") +
  theme(axis.text.x = element_text(hjust = 1)) +
  coord_cartesian(ylim = c(0, 100))  # Limit y-axis to 0-100

print(boxplot_plot3)

```

Interpretation:

-   The major difference is the change in the total number of victims: y axis which ranged from 0-600 in first plot and 0-100 in plot excluding Las Vegas.

-   Though, there seems to be a similar pattern in the occurrences of shootings across each location type, shootings in "other" locations are seem to be more common in Las Vegas.

## Exercise 4

```{r}
#| label: ex4
# Filter 
white_mental_illness_incidents <- mass_shootings |>
  filter(
    race == "White",
    grepl("yes", tolower(prior_mental_illness)),
    year > 2000
  )

# Count the number of incidents
num_incidents <- nrow(white_mental_illness_incidents)

# Print the number of incidents
print(num_incidents)
```

-   **"28" white individuals with prior signs of mental illness initiated a mass shooting after 2000.**

## Exercise 5

```{r}
#| label: ex5

# Extract state from the location column
mass_shootings <- mass_shootings |>
  mutate(state = word(location, -1, sep = ", "))

# Number of incidents per state
incident_counts <- mass_shootings|>
  group_by(state) |>
  summarize(num_incidents = n())

# Sort the data 
incident_counts <- incident_counts[order
                                   (-incident_counts$num_incidents), ]

# Create a bar plot
bar_plot <- ggplot(incident_counts, 
                   aes(x = reorder(state, -num_incidents), 
                       y = num_incidents)) +
  geom_bar(stat = "identity", fill = "red2") +
  labs(x = "State", y = "Number of Shooting incidents") +
  ggtitle("Mass Shooting Incidents by State") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Print the bar plot
print(bar_plot)

```

-   California, Florida, and Texas having the most mass shooting incidents is likely influenced by their high population densities. More people can mean a higher incidence of various crimes, including mass shootings. Additionally, population density can contribute to social and economic factors that may indirectly influence the occurrence of such incidents.

-   California has some of the most stringent gun laws in the country, but perhaps the guns are already prevalent in the state.

-   Factors contributing to the pattern may involve various socio-economic, cultural, and policy-related aspects.

-   States with lower numbers of mass shootings like NJ, New Mexico, Utah, Iowa, Kansas, DC, and Arizona may have factors such as stricter gun laws, lower population density, stronger socioeconomic conditions, better mental health support, tight-knit communities, effective law enforcement, and proactive public awareness campaigns that contribute to fewer incidents.

## Exercise 6

```{r}
#| label: ex6

# Mean and median age of mass shooters
age_summary_by_year <- mass_shootings |>
  group_by(year) |>
  summarize(mean_age = mean(age_of_shooter, 
                            na.rm = TRUE),
            median_age = median(age_of_shooter, 
                                na.rm = TRUE))

# Plot
ggplot(age_summary_by_year, aes(x = year, y = mean_age)) +
  geom_line(aes(color = "Mean Age"), size = 1) +
  geom_point(aes(color = "Mean Age"), size = 3) +
  geom_line(aes(y = median_age, color = "Median Age"), 
            linetype = "dashed", size = 1) +
  geom_point(aes(y = median_age, color = "Median Age"), 
             shape = 1, size = 3) +
  labs(x = "Year", y = "Age", 
       title = "Mean and Median Age of Mass Shooters Over Time") +
  scale_color_manual(values = c("Mean Age" = "orange", 
                                "Median Age" = "black")) +
  theme_minimal() +
  theme(legend.position = "top")

```

-   Until early 2000s, shootings were perpetrated by all age groups almost evenly.

-   Recent mass shootings do happen to be perpetrated by younger individuals (in their 20-40s)

-   The typical age of a mass shooter in the 1980s ranged from 35 to 60. In the 1990s, it ranged from 20 to 40. In the early 2000s, it was 40 to 60. In recent times, it is mostly between 20 and 40. It was only in the late 1990s that the typical age dipped below 20 years.
